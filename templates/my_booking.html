<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Bookings</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <style>
    body{
      margin:0;
      font-family: Arial, Helvetica, sans-serif;
      background:#F6F8FC;
      color:#0E1D2D;
    }

    .page{
      width:100%;
      max-width:none;
      padding:40px 32px;
    }

    /* ✅ זה מה שחסר אצלך: אין max-width על ה-card */
    .card{
      width:100%;
      max-width:none;
      background:#fff;
      border-radius:22px;
      padding:26px;
      box-shadow:0 14px 36px rgba(14,29,45,0.12);
      border:1px solid #E6EBF3;
    }

    h1{ margin:0 0 10px; font-size:28px; }
    h2{ margin:18px 0 10px; font-size:20px; }

    .muted{ color:#546275; font-size:14px; }
    .section{ margin-top:18px; }

    .search-card{
      background:rgba(201,182,255,.14);
      border:1px solid rgba(201,182,255,.45);
      border-radius:16px;
      padding:14px;
      margin-top:12px;
    }

    label{
      display:block;
      font-weight:bold;
      font-size:14px;
      margin:10px 0 6px;
    }

    input{
      width:100%;
      max-width:420px;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid #E6EBF3;
      font-size:14px;
      box-sizing:border-box;
    }

    input:focus{
      outline:none;
      border-color:#6F5BFF;
      box-shadow:0 0 0 3px rgba(201,182,255,0.5);
    }

    .btn{
      padding:12px 14px;
      border-radius:14px;
      font-weight:bold;
      cursor:pointer;
      border:1px solid transparent;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size:14px;
    }

    .btn-primary{ background:#4A7A87; color:white; }
    .btn-primary:hover{ background:#2E4D5C; }

    .btn-ghost{
      background:white;
      color:#0E1D2D;
      border-color:#E6EBF3;
    }
    .btn-ghost:hover{ background:rgba(201,182,255,.18); }

    .btn-danger{
      background:rgba(14,29,45,.10);
      color:#0E1D2D;
      border-color:#E6EBF3;
    }
    .btn-danger:hover{ background:rgba(14,29,45,.16); }

    table{
      width:100%;
      border-collapse:collapse;
      margin-top:12px;
      font-size:14px;
    }

    th{
      background:#F1F4FA;
      text-align:left;
      padding:10px;
      border-bottom:2px solid #E6EBF3;
      white-space:nowrap;
    }

    td{
      padding:10px;
      border-bottom:1px solid #E6EBF3;
      vertical-align:top;
    }

    tr:hover{ background:#FAFBFE; }

    .nowrap{ white-space:nowrap; }

    .footer-actions{
      margin-top:18px;
      display:flex;
      justify-content:flex-start;
      gap:10px;
    }
  </style>
</head>

<body>
<div class="page">
  <div class="card">

    <h1>My Bookings</h1>

    {% if not email %}
      <div class="search-card">
        <form method="GET" action="/my_booking">
          <p class="muted" style="margin:0 0 10px;">Enter your email to view your bookings:</p>
          <label>Email</label>
          <input name="email" placeholder="Email" required>
          <div style="margin-top:12px;">
            <button class="btn btn-primary" type="submit">Show bookings</button>
          </div>
        </form>
      </div>
    {% else %}
      <p class="muted" style="margin:0 0 12px;">Showing bookings for: <b>{{ email }}</b></p>

      <div class="section">
        <h2>Upcoming flights</h2>
        {% if upcoming|length == 0 %}
          <p class="muted">No upcoming flights.</p>
        {% else %}
          <table>
            <thead>
              <tr>
                <th>Booking</th>
                <th>Route</th>
                <th>Date & Time</th>
                <th>Seats</th>
                <th>Status</th>
                <th>Total Paid Price</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {% for b in upcoming %}
              <tr>
                <td class="nowrap">#{{ b.booking_code }}</td>
                <td>{{ b.Departure_Airport }} → {{ b.Destination_Airport }}</td>
                <td class="nowrap">{{ b.Flight_Date }} {{ b.Departure_Time }}</td>
                <td>{{ b.seats }}</td>
                <td class="nowrap">{{ b.status }}</td>
                <td class="nowrap">{{ b.total_price }}</td>
                <td class="nowrap">
                  {% if b.status|lower not in ['customer cancelled', 'customer cancelled', 'cancelled'] %}
                    <form method="POST" action="/booking/cancel" style="margin:0;">
                      <input type="hidden" name="booking_code" value="{{ b.booking_code }}">
                      <input type="hidden" name="email" value="{{ email }}">
                      <button class="btn btn-danger" type="submit">Cancel</button>
                    </form>
                  {% else %}
                    <span class="muted">—</span>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endif %}
      </div>

      <div class="section">
        <h2>History</h2>
        {% if history|length == 0 %}
          <p class="muted">No history yet.</p>
        {% else %}
          <table>
            <thead>
              <tr>
                <th>Booking</th>
                <th>Route</th>
                <th>Date & Time</th>
                <th>Seats</th>
                <th>Status</th>
                <th>Total Paid Price</th>
              </tr>
            </thead>
            <tbody>
              {% for b in history %}
              <tr>
                <td class="nowrap">#{{ b.booking_code }}</td>
                <td>{{ b.Departure_Airport }} → {{ b.Destination_Airport }}</td>
                <td class="nowrap">{{ b.Flight_Date }} {{ b.Departure_Time }}</td>
                <td>{{ b.seats }}</td>
                <td class="nowrap">{{ b.status }}</td>
                <td class="nowrap">{{ b.total_price }}$</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endif %}
      </div>
    {% endif %}

    <div class="footer-actions">
      <a class="btn btn-ghost" href="/session/clear">Back</a>
    </div>

  </div>
</div>
</body>
</html>
