<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <style>
    body{
      margin:0;
      font-family: Arial, Helvetica, sans-serif;
      background:#F6F8FC;
      color:#0E1D2D;
    }

    .page{
      width: 100%;
      max-width: none;
      margin: 40px auto;
      padding: 0 32px;
    }

    .card{
      width: 100%;
      max-width: none;
      background:#fff;
      border-radius:22px;
      padding:26px;
      box-shadow:0 14px 36px rgba(14,29,45,0.12);
      border:1px solid #E6EBF3;
    }

    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:16px;
      margin-bottom:20px;
      flex-wrap:wrap;
    }

    h1{
      margin:0;
      font-size:28px;
    }

    h2{
      margin:26px 0 10px;
    }

    .muted{
      color:#546275;
      font-size:14px;
    }

    .actions{
      display:flex;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
    }

    .btn{
      padding:10px 14px;
      border-radius:14px;
      font-weight:bold;
      cursor:pointer;
      border:1px solid transparent;
      text-decoration:none;
      display:inline-block;
      text-align:center;
      white-space:nowrap;
    }

    .btn-primary{
      background:#4A7A87;
      color:white;
    }

    .btn-primary:hover{
      background:#2E4D5C;
    }

    .btn-accent{
      background:rgba(201,182,255,.4);
      color:#0E1D2D;
      border-color:rgba(201,182,255,.7);
    }

    .btn-accent:hover{
      background:rgba(191,167,255,.55);
    }

    .btn-danger{
      background:#0E1D2D;
      color:white;
    }

    table{
      width:100%;
      border-collapse:collapse;
      margin-top:14px;
      font-size:14px;
    }

    th{
      background:#F1F4FA;
      text-align:left;
      padding:10px;
      border-bottom:2px solid #E6EBF3;
    }

    td{
      padding:10px;
      border-bottom:1px solid #E6EBF3;
      vertical-align:top;
    }

    tr:hover{
      background:#FAFBFE;
    }

    form{
      margin:0;
    }

    .note{
      margin-top:14px;
      font-size:13px;
      color:#546275;
    }

    /* ✅ filter row */
    .filter-row{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }

    .filter-row label{
      font-size:13px;
      color:#546275;
      font-weight:bold;
    }

    select{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid #E6EBF3;
      background:#fff;
      outline:none;
      font-size:14px;
    }

    select:focus{
      border-color: rgba(74,122,135,.65);
      box-shadow: 0 0 0 4px rgba(74,122,135,.12);
    }

    @media(max-width:900px){
      table{
        font-size:13px;
      }
    }
  </style>
</head>

<body>
<div class="page">
  <div class="card">

    <div class="topbar">
      <div>
        <h1>Admin Dashboard</h1>
        <div class="muted">Welcome, <b>{{ admin_name }}</b></div>

        <!-- ✅ סינון לפי סטטוס (GET) -->
        <form class="filter-row" method="GET" action="/admin_dashboard">
          <label for="status">Filter by status:</label>

          <select id="status" name="status">
            <option value="all" {% if (selected_status|string)|lower == "all" %}selected{% endif %}>All</option>

            {% for s in statuses %}
              <option value="{{ s }}" {% if selected_status == s %}selected{% endif %}>{{ s }}</option>
            {% endfor %}
          </select>

          <button class="btn btn-primary" type="submit">Apply</button>

          {% if (selected_status|string)|lower != "all" %}
            <a class="btn btn-accent" href="/admin_dashboard?status=all">Clear</a>
          {% endif %}
        </form>
      </div>

      <div class="actions">
        <a href="/admin_add_flight" class="btn btn-accent">+ Add New Flight</a>
        <a href="/admin_add_plane" class="btn btn-accent">+ Add New Plane</a>
        <a href="/admin_add_crew" class="btn btn-accent">+ Add New Crew Member</a>
        <a href="/admin_logout" class="btn btn-danger">Logout</a>
      </div>
    </div>

    <h2>All Flights</h2>

    {% if flights|length == 0 %}
      <p class="muted">No flights.</p>
    {% else %}
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Departure</th>
            <th>Landing</th>
            <th>Route</th>
            <th>Plane</th>
            <th>Status</th>
            <th>Hours Left</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
        {% for f in flights %}
          <tr>
            <td>{{ f.Flight_Date }}</td>
            <td>{{ f.Departure_Time }}</td>
            <td>{{ f.Landing_Time }}</td>
            <td>{{ f.Departure_Airport }} → {{ f.Destination_Airport }}</td>
            <td>{{ f.Plane_ID }}</td>
            <td>{{ f.status }}</td>
            <td>{{ f.hours_left }}</td>
            <td>
              {% if f.can_cancel %}
                <form method="POST" action="/admin_cancel_flight">
                  <input type="hidden" name="flight_date" value="{{ f.Flight_Date }}">
                  <input type="hidden" name="departure_time" value="{{ f.Departure_Time }}">
                  <button class="btn btn-primary" type="submit">Cancel</button>
                </form>
              {% else %}
                <span class="muted">—</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>

      <div class="note">
        * Cancel is enabled only for future flights with more than 72 hours left.
        Cancelling sets flight status to <b>cancelled</b> and bookings to
        <b>admin cancelled</b> with full refund.
      </div>
    {% endif %}

  </div>
</div>
</body>
</html>
